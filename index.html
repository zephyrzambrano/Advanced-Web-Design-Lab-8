<!doctype html>
<html>
	<head>
		<title>Lab 8</title>
	</head>
    
	<body>
        
        <canvas id="canvas" width="1260" height="630">
            Upgrade your browser to see the HTML5 Canvas!
        </canvas>
		
		<script>
            //map image
            //https://images.pexels.com/photos/87652/earth-map-summer-july-87652.jpeg?cs=srgb&dl=earth-geography-map-87652.jpg&fm=jpg
            
            //lat/long reference:
            //http://www.satsig.net/lat_long.htm
            
            var canvas=document.getElementById("canvas");
            c=canvas.getContext("2d");
            
            
            //draw image onto canvas source
            //https://stackoverflow.com/questions/3868259/importing-image-on-canvas-html5
			var img=new Image();
			img.onload = function() {
				var ca=document.getElementById('canvas').getContext('2d');
				ca.drawImage(img, 0, 0);
			}
            img.src="worldmap.jpeg";
			
            
			window.setInterval(refresh, 1000);
			var apiBase="http://api.open-notify.org/iss-now.json";
			var data;
			
			//var info=document.getElementById("info");
            var timestamp=document.getElementById("timestamp");
            var message=document.getElementById("message");
            var latitude=document.getElementById("latitude");
            var longitude=document.getElementById("longitude");
            
            //Set up xhr
            var xhr = new XMLHttpRequest();
            
            //Set the button listener
            //button.addEventListener("click", refresh);
            
            function refresh() {
                //Tell it what to do when it's loaded
                xhr.addEventListener("load",loadData);
                //Tell it the file to load
                xhr.open("GET", apiBase);
                //GO!
                xhr.send();
            }
			
			//parse and display data
			function loadData() {
                
                //accessing api data:
                //data.timestamp
				//data.message-box
				//data.iss_position.latitude
				//data.iss_position.longitude
			
				data=JSON.parse(xhr.responseText);
				
                
                latitude=data.iss_position.latitude;
				longitude=data.iss_position.longitude;
                
                drawDot(latitude, longitude);
                
                console.log("Loaded!");
				
			}
            
            function drawDot (lat, long) {
                
                var x=(lon/630 * canvas.width/2)+canvas.width/2;
                var y=-(lat/315 * canvas.height/2)+canvas.height/2;
                
                c.fillStyle="red";
                c.arc(x, y, 50, 0, 2*Math.PI);
                c.fill();
                
                c.font="30px Arial";
                c.fillText(longitude, canvas.width/2, 600);
                c.fillText(latitude, canvas.width/2, 615);
            }
			
		</script>
	</body>
</html>